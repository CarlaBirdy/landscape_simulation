---
title: "Benefit Plots"
output: 
  html_document:
    keep_md: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(plyr)
library(tidyverse)
library(cowplot)
```

Load results of the simulations (`sim_benefit.R`). We filter the results to only take benefit function values $\alpha = 1, \beta = 0.1, \gamma = 0.1$.  

```{r}
f <- list.files("results/benefit_replicates/", pattern = "file", full.names = TRUE)

out <- ldply(f, function(x) get(load(x))) %>% 
  group_by(p_supply, p_demand, f_supply, f_demand, inter, es_thresh, ee_thresh, rival, alpha, beta, gamma) %>% 
  summarise(num_supply_mean = mean(num_supply),
            num_supply_sd = sd(num_supply),
            num_demand_mean = mean(num_demand),
            num_demand_sd = sd(num_demand),
            ee_density_mean = mean(ee_density),
            ee_density_sd = sd(ee_density),
            se_density_mean = mean(se_density),
            se_density_sd = sd(se_density),
            benefit_mean = mean(benefit),
            benefit_sd = sd(benefit)) %>% 
  filter(alpha == "1", 
         beta == "0.1", 
         gamma == "0.1") %>% 
  ungroup %>% 
  mutate(rival = case_when(rival == FALSE ~ "Non-rival",
                           TRUE ~ "Rival"),
         inter = paste0("inter = ", inter))
```

# No supply-supply links, proximal supply-demand links

```{r}
# calculate scenarios
lowlow <- filter(out, p_supply == 0.1, p_demand == 0.1, is.na(ee_thres), es_thresh == 20)
lowhigh <- filter(out, p_supply == 0.4, p_demand == 0.1, is.na(ee_thres), es_thresh == 20)
highlow <- filter(out, p_supply == 0.1, p_demand == 0.4, is.na(ee_thres), es_thresh == 20)
highhigh <- filter(out, p_supply == 0.4, p_demand == 0.4, is.na(ee_thres), es_thresh == 20)
```


```{r, fig.width=15, fig.height = 8}
p_lowlow <- ggplot(lowlow, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, low S")

p_lowhigh <- ggplot(lowhigh, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, high S")

p_highlow <- ggplot(highlow, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, low S")

p_highhigh <- ggplot(highhigh, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, high S")

plot_grid(p_lowlow, p_lowhigh, p_highlow, p_highhigh, nrow = 2)
```

# No supply-supply links, full supply-demand links

```{r}
# calculate scenarios
lowlow <- filter(out, p_supply == 0.1, p_demand == 0.1, is.na(ee_thres), es_thresh == 100)
lowhigh <- filter(out, p_supply == 0.4, p_demand == 0.1, is.na(ee_thres), es_thresh == 100)
highlow <- filter(out, p_supply == 0.1, p_demand == 0.4, is.na(ee_thres), es_thresh == 100)
highhigh <- filter(out, p_supply == 0.4, p_demand == 0.4, is.na(ee_thres), es_thresh == 100)
```


```{r, fig.width=15, fig.height = 8}
p_lowlow <- ggplot(lowlow, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, low S")

p_lowhigh <- ggplot(lowhigh, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, high S")

p_highlow <- ggplot(highlow, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, low S")

p_highhigh <- ggplot(highhigh, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, high S")

plot_grid(p_lowlow, p_lowhigh, p_highlow, p_highhigh, nrow = 2)
```

# Proximal supply-supply links, proximal supply-demand links

```{r}
# calculate scenarios
lowlow <- filter(out, p_supply == 0.1, p_demand == 0.1, ee_thres == 20, es_thresh == 20)
lowhigh <- filter(out, p_supply == 0.4, p_demand == 0.1, ee_thres == 20, es_thresh == 20)
highlow <- filter(out, p_supply == 0.1, p_demand == 0.4, ee_thres == 20, es_thresh == 20)
highhigh <- filter(out, p_supply == 0.4, p_demand == 0.4, ee_thres == 20, es_thresh == 20)
```


```{r, fig.width=15, fig.height = 8}
p_lowlow <- ggplot(lowlow, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, low S")

p_lowhigh <- ggplot(lowhigh, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, high S")

p_highlow <- ggplot(highlow, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, low S")

p_highhigh <- ggplot(highhigh, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, high S")

plot_grid(p_lowlow, p_lowhigh, p_highlow, p_highhigh, nrow = 2)
```

# Proximal supply-supply links, full supply-demand links

```{r}
# calculate scenarios
lowlow <- filter(out, p_supply == 0.1, p_demand == 0.1, ee_thres == 20, es_thresh == 100)
lowhigh <- filter(out, p_supply == 0.4, p_demand == 0.1, ee_thres == 20, es_thresh == 100)
highlow <- filter(out, p_supply == 0.1, p_demand == 0.4, ee_thres == 20, es_thresh == 100)
highhigh <- filter(out, p_supply == 0.4, p_demand == 0.4, ee_thres == 20, es_thresh == 100)
```


```{r, fig.width=15, fig.height = 8}
p_lowlow <- ggplot(lowlow, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, low S")

p_lowhigh <- ggplot(lowhigh, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, high S")

p_highlow <- ggplot(highlow, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, low S")

p_highhigh <- ggplot(highhigh, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, high S")

plot_grid(p_lowlow, p_lowhigh, p_highlow, p_highhigh, nrow = 2)
```

# Full supply-supply links, proximal supply-demand links

```{r}
# calculate scenarios
lowlow <- filter(out, p_supply == 0.1, p_demand == 0.1, ee_thres == 100, es_thresh == 20)
lowhigh <- filter(out, p_supply == 0.4, p_demand == 0.1, ee_thres == 100, es_thresh == 20)
highlow <- filter(out, p_supply == 0.1, p_demand == 0.4, ee_thres == 100, es_thresh == 20)
highhigh <- filter(out, p_supply == 0.4, p_demand == 0.4, ee_thres == 100, es_thresh == 20)
```


```{r, fig.width=15, fig.height = 8}
p_lowlow <- ggplot(lowlow, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, low S")

p_lowhigh <- ggplot(lowhigh, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, high S")

p_highlow <- ggplot(highlow, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, low S")

p_highhigh <- ggplot(highhigh, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, high S")

plot_grid(p_lowlow, p_lowhigh, p_highlow, p_highhigh, nrow = 2)
```

# Full supply-supply links, full supply-demand links

```{r}
# calculate scenarios
lowlow <- filter(out, p_supply == 0.1, p_demand == 0.1, ee_thres == 100, es_thresh == 100)
lowhigh <- filter(out, p_supply == 0.4, p_demand == 0.1, ee_thres == 100, es_thresh == 100)
highlow <- filter(out, p_supply == 0.1, p_demand == 0.4, ee_thres == 100, es_thresh == 100)
highhigh <- filter(out, p_supply == 0.4, p_demand == 0.4, ee_thres == 100, es_thresh == 100)
```


```{r, fig.width=15, fig.height = 8}
p_lowlow <- ggplot(lowlow, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, low S")

p_lowhigh <- ggplot(lowhigh, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, high S")

p_highlow <- ggplot(highlow, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, low S")

p_highhigh <- ggplot(highhigh, aes(x = f_supply, y = f_demand, fill = benefit_mean)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, high S")

plot_grid(p_lowlow, p_lowhigh, p_highlow, p_highhigh, nrow = 2)
```
