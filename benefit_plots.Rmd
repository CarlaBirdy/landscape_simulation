---
title: "Benefit Plots"
output: 
  html_document:
    keep_md: true
params:
  fn: "mean"
  measure: "benefit"
  alpha_val: 1
  beta_val: 0
  gamma_val: 0.5
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(cowplot)

cv <- function(x, na.rm = TRUE) {
  sd(x)/mean(x)
}
```

Load results of the simulations (`es_benefit.R`). 

Plots show `r params$fn` `r params$measure` for alpha = `r params$alpha_val`; beta = `r params$beta_val`; gamma = `r params$gamma_val`

```{r}
load("results/benefit_all_replicates.rda")
out <- out %>% 
  group_by(p_supply, p_demand, f_supply, f_demand, inter, es_thresh, ee_thresh, rival, alpha, beta, gamma) %>% 
  summarise(value = get(params$fn)(get(params$measure), na.rm=TRUE)) %>% 
  filter(alpha == params$alpha_val, 
         beta == params$beta_val, 
         gamma == params$gamma_val) %>% 
  ungroup %>% 
  mutate(rival = case_when(rival == FALSE ~ "Non-rival",
                           TRUE ~ "Rival"),
         inter = paste0("inter = ", inter))
```

# No supply-supply links, proximal supply-demand links

```{r}
# calculate scenarios
lowlow <- filter(out, p_supply == 0.1, p_demand == 0.1, is.na(ee_thresh), es_thresh == 20)
lowhigh <- filter(out, p_supply == 0.4, p_demand == 0.1, is.na(ee_thresh), es_thresh == 20)
highlow <- filter(out, p_supply == 0.1, p_demand == 0.4, is.na(ee_thresh), es_thresh == 20)
highhigh <- filter(out, p_supply == 0.4, p_demand == 0.4, is.na(ee_thresh), es_thresh == 20)
```


```{r, fig.width=15, fig.height = 8}
p_lowlow <- ggplot(lowlow, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, low S")

p_lowhigh <- ggplot(lowhigh, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, high S")

p_highlow <- ggplot(highlow, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, low S")

p_highhigh <- ggplot(highhigh, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, high S")

plot_grid(p_lowlow, p_lowhigh, p_highlow, p_highhigh, nrow = 2)
```

# No supply-supply links, full supply-demand links

```{r}
# calculate scenarios
lowlow <- filter(out, p_supply == 0.1, p_demand == 0.1, is.na(ee_thresh), es_thresh == 100)
lowhigh <- filter(out, p_supply == 0.4, p_demand == 0.1, is.na(ee_thresh), es_thresh == 100)
highlow <- filter(out, p_supply == 0.1, p_demand == 0.4, is.na(ee_thresh), es_thresh == 100)
highhigh <- filter(out, p_supply == 0.4, p_demand == 0.4, is.na(ee_thresh), es_thresh == 100)
```


```{r, fig.width=15, fig.height = 8}
p_lowlow <- ggplot(lowlow, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, low S")

p_lowhigh <- ggplot(lowhigh, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, high S")

p_highlow <- ggplot(highlow, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, low S")

p_highhigh <- ggplot(highhigh, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, high S")

plot_grid(p_lowlow, p_lowhigh, p_highlow, p_highhigh, nrow = 2)
```

# Proximal supply-supply links, proximal supply-demand links

```{r}
# calculate scenarios
lowlow <- filter(out, p_supply == 0.1, p_demand == 0.1, ee_thresh == 20, es_thresh == 20)
lowhigh <- filter(out, p_supply == 0.4, p_demand == 0.1, ee_thresh == 20, es_thresh == 20)
highlow <- filter(out, p_supply == 0.1, p_demand == 0.4, ee_thresh == 20, es_thresh == 20)
highhigh <- filter(out, p_supply == 0.4, p_demand == 0.4, ee_thresh == 20, es_thresh == 20)
```


```{r, fig.width=15, fig.height = 8}
p_lowlow <- ggplot(lowlow, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, low S")

p_lowhigh <- ggplot(lowhigh, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, high S")

p_highlow <- ggplot(highlow, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, low S")

p_highhigh <- ggplot(highhigh, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, high S")

plot_grid(p_lowlow, p_lowhigh, p_highlow, p_highhigh, nrow = 2)
```

# Proximal supply-supply links, full supply-demand links

```{r}
# calculate scenarios
lowlow <- filter(out, p_supply == 0.1, p_demand == 0.1, ee_thresh == 20, es_thresh == 100)
lowhigh <- filter(out, p_supply == 0.4, p_demand == 0.1, ee_thresh == 20, es_thresh == 100)
highlow <- filter(out, p_supply == 0.1, p_demand == 0.4, ee_thresh == 20, es_thresh == 100)
highhigh <- filter(out, p_supply == 0.4, p_demand == 0.4, ee_thresh == 20, es_thresh == 100)
```


```{r, fig.width=15, fig.height = 8}
p_lowlow <- ggplot(lowlow, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, low S")

p_lowhigh <- ggplot(lowhigh, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, high S")

p_highlow <- ggplot(highlow, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, low S")

p_highhigh <- ggplot(highhigh, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, high S")

plot_grid(p_lowlow, p_lowhigh, p_highlow, p_highhigh, nrow = 2)
```

# Full supply-supply links, proximal supply-demand links

```{r}
# calculate scenarios
lowlow <- filter(out, p_supply == 0.1, p_demand == 0.1, ee_thresh == 100, es_thresh == 20)
lowhigh <- filter(out, p_supply == 0.4, p_demand == 0.1, ee_thresh == 100, es_thresh == 20)
highlow <- filter(out, p_supply == 0.1, p_demand == 0.4, ee_thresh == 100, es_thresh == 20)
highhigh <- filter(out, p_supply == 0.4, p_demand == 0.4, ee_thresh == 100, es_thresh == 20)
```


```{r, fig.width=15, fig.height = 8}
p_lowlow <- ggplot(lowlow, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, low S")

p_lowhigh <- ggplot(lowhigh, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, high S")

p_highlow <- ggplot(highlow, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, low S")

p_highhigh <- ggplot(highhigh, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, high S")

plot_grid(p_lowlow, p_lowhigh, p_highlow, p_highhigh, nrow = 2)
```

# Full supply-supply links, full supply-demand links

```{r}
# calculate scenarios
lowlow <- filter(out, p_supply == 0.1, p_demand == 0.1, ee_thresh == 100, es_thresh == 100)
lowhigh <- filter(out, p_supply == 0.4, p_demand == 0.1, ee_thresh == 100, es_thresh == 100)
highlow <- filter(out, p_supply == 0.1, p_demand == 0.4, ee_thresh == 100, es_thresh == 100)
highhigh <- filter(out, p_supply == 0.4, p_demand == 0.4, ee_thresh == 100, es_thresh == 100)
```


```{r, fig.width=15, fig.height = 8}
p_lowlow <- ggplot(lowlow, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, low S")

p_lowhigh <- ggplot(lowhigh, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("Low D, high S")

p_highlow <- ggplot(highlow, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, low S")

p_highhigh <- ggplot(highhigh, aes(x = f_supply, y = f_demand, fill = value)) + 
  geom_tile() + 
  scale_fill_viridis_c() + 
  facet_grid(rival ~ inter) + 
  ggtitle("High D, high S")

plot_grid(p_lowlow, p_lowhigh, p_highlow, p_highhigh, nrow = 2)
```
